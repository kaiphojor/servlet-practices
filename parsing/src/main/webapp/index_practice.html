<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<body>
	<input type=text name=url>
	<input type=button value="url 로드" onclick="loadURL()">
	<div id=output></div>

	<h1>goodbye world</h1>
	<p id="demo1"></p>
	<p id="demo"></p>
	<ol id='browserHistory'>
	</ol>


</body>
<script>
	window.onbeforeunload = function(event) {
		var url = window.location.href;
		var browserHistory = JSON.parse(localStorage.getItem('history'));
		if (browserHistory == undefined) {
			browserHistory = [];
		}
		browserHistory.push(item);
		localStorage.setItem('history', JSON.stringify(browserHistory));
	}
	hist = localStorage.getItem('history');
	var historyList;
	if(hist != null){
		historyList = JSON.parse(hist);
	}else{
		historyList = [];
	}
	console.log(hist);
	console.log(typeof historyList);
	console.log(historyList === null); // false
	console.log(historyList === undefined); // false
	if (typeof (Storage) !== "undefined" && typeof historyList !== "undefined") {
		var ol = document.getElementById('browserHistory');
		for (var i = 0; i < historyList.length; i++) {			
			var li = document.createElement("li");
			var liText = document.createTextNode(historyList[i]);
			li.appendChild(liText);
			ol.appendChild(li);
		}
	}
	var ol1 = document.getElementById('browserHistory');
	console.log(ol1);
	var li1 = document.createElement("li");
	var liText1 = document.createTextNode(document.URL);
	console.log(document.URL);
	console.log(document.location.href);
	li1.appendChild(liText1);
	ol1.appendChild(li1);

	function loadURL() {
		var url = document.all.url;
		if (url.value == "") {
			alert("url 을 입력해야합니다.");
			url.focus();
			return;
		}

		var xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		xmlhttp.open("GET", url.value, "false");
		xmlhttp.send();
		//document.all.output.innerText = xmlhttp.responseText;
		var text = xmlhttp.responseText;

		var idx = 0;
		var arr = new Array();
		while (text.indexOf("<a", idx) != -1) {
			var index = text.indexOf("<a", idx);
			var indexEnd = text.indexOf(">", index);
			var sliced = text.slice(index, indexEnd);
			var hrefStart = text.indexOf('href="', index);
			var hrefEnd = text.indexOf('"', hrefStart + 6);
			var slicedHref = text.slice(hrefStart + 6, hrefEnd);
			if (slicedHref.charAt(0) == 'h') {
				arr.push(slicedHref);
			}
			//wholeText += slicedHref;		  
			idx = indexEnd + 1;
		}
		document.write("a href 외부링크 개수 : " + arr.length + "<br>");
		for (var i = 0; i < arr.length; i++) { //배열 출력
			//document.write(arr[i]+"<br>");
		}
		idx = 0;
		var imageArr = new Array();
		var linkArr = new Array();
		while (text.indexOf("<img", idx) != -1) {
			var index = text.indexOf("<img", idx);
			var indexEnd = text.indexOf(">", index);
			var sliced = text.slice(index, indexEnd + 1);
			var srcStart = text.indexOf('src="', index);
			var srcEnd = text.indexOf('"', srcStart + 5);
			var slicedLink = text.slice(srcStart + 5, srcEnd);
			imageArr.push(sliced);
			linkArr.push(slicedLink);
			idx = indexEnd + 1;
		}
		document.write("img 개수 : " + imageArr.length + "<br>");
		for (var i = 0; i < imageArr.length; i++) { //배열 출력
			document.write(linkArr[i] + "<br>");
			document.write(imageArr[i] + "<br>");
		}
	}
</script>
</html>